<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.marry.company">
	<select id="companySelectOne" parameterType="Integer" resultType="com.marry.company.model.CompanyDTO">
	select
		*
	from
		company
	where
		cidx = #{cidx}
		and clevel = 1
		and blind = 0
	</select>
	<select id="selectHall" parameterType="Integer" resultType="com.marry.company.model.HallDTO">
	select
		*
	from	
		hall
	where
		cidx = #{cidx}
	order by
		hidx asc
	</select>
	<select id="selectFood" parameterType="Integer" resultType="com.marry.company.model.FoodDTO">
	select
		*
	from
		food
	where
		cidx = #{cidx}
	order by
		fidx asc
	</select>
	<select id="selectImg" parameterType="Integer" resultType="com.marry.company.model.Com_ImgDTO">
	select
		*
	from
		com_img
	where
		cidx = #{cidx}
	order by
		iidx asc
	</select>
	<insert id="insertReview" parameterType="com.marry.company.model.ReviewDTO">
	insert into 
		review
	values (
		review_ridx.nextval,
		#{cidx},
		#{midx},
		#{content},
		#{star},
		sysdate
		)
	</insert>
	<select id="selectReview" parameterType="Integer" resultType="com.marry.company.model.ReviewDTO">
	select
		*
	from
		review
	where
		cidx = #{cidx}
	order by
		ridx asc
	</select>
	<select id="selectLike" parameterType="com.marry.company.model.Com_LikeDTO" resultType="com.marry.company.model.Com_LikeDTO">
	select
		*
	from
		com_like
	where
		cidx = #{cidx}
		and midx = #{midx}
	</select>
	<insert id="insertLike" parameterType="com.marry.company.model.Com_LikeDTO">
	insert into 
		com_like
	values (
		com_like_lidx.nextval,
		#{midx},
		#{cidx}
		)
	</insert>
	<delete id="deleteLike" parameterType="com.marry.company.model.Com_LikeDTO">
	delete from
		com_like
	where
		lidx = #{lidx}
	</delete>
	<insert id="insertcomcs" parameterType="com.marry.company.model.Com_CsDTO">
	insert into
		com_cs
	values (
		com_cs_ccsidx.nextval,
		#{cidx},
		#{midx},
		#{subject},
		#{content},
		sysdate,
		null,
		null,
		#{is_private},
		0
		)
	</insert>
	<select id="selectcomcs" resultType="com.marry.company.model.Com_CsDTO">
	select
	    com_cs.*, member.name as mname, company.cname as cname
	from	
	    com_cs, member, company
	where
	    com_cs.cidx = #{cidx}
	    and member.midx = com_cs.midx
	    and company.cidx = #{cidx}
	order by
	    ccsidx desc	
	</select>
	<select id="selectmemcs" resultType="com.marry.company.model.Com_CsDTO">
	select
	    com_cs.*, member.name as mname, company.cname as cname
	from	
	    com_cs, member, company
	where
	    com_cs.midx = #{midx}
	    and member.midx = #{midx}
	    and company.cidx = com_cs.cidx
	order by
	    ccsidx desc	
	</select>
	<select id="answeredcs" resultType="com.marry.company.model.Com_CsDTO">
	select
	    com_cs.*, member.name as mname, company.cname as cname
	from	
	    com_cs, member, company
	where
	    com_cs.cidx = #{cidx}
	    and member.midx = com_cs.midx
	    and company.cidx = #{cidx}
	    and is_answered = 1
	order by
	    ccsidx desc	
	</select>
	<update id="updatecomcs" parameterType="com.marry.company.model.Com_CsDTO">
	update 
		com_cs
	set
		answer = #{answer},
		ansdate = sysdate,
		is_answered = 1
	where 
		ccsidx = #{ccsidx}
	</update>
	<select id="selectmembook" resultType="com.marry.book.model.BookListDTO">
	select
	   book.*, company.cname, company.kind as ckind, company.pay as cpay, hall.pay as hpay, 
	   food.pay as fpay, hall.guest_num as hnum, 
        case
        when sysdate > book.bk_date then 1
        else 0
        end as is_after 
    from
	    book
	left join
	    member
	on 
	    book.midx = member.midx
	left join 
	    company
	on
	    book.cidx = company.cidx
	left join
	    hall
	on
	    book.hidx = hall.hidx
	left join
	    food
	on
	    book.fidx = food.fidx
	where
	    book.midx = #{midx}
	</select>
	<select id="selectcombook" resultType="com.marry.book.model.BookListDTO">
	select
	   book.*, member.name as mname, 
       hall.name as hname, hall.pay as hpay, 
       hall.guest_num as hnum, food.name as fname, 
       food.pay as fpay, company.pay as cpay,
       company.kind as ckind, 
        case
        when sysdate > book.bk_date then 1
        else 0
        end as is_after 
    from
	    book
	left join
	    member
	on 
	    book.midx = member.midx
	left join 
	    company
	on
	    book.cidx = company.cidx
	left join
	    hall
	on
	    book.hidx = hall.hidx
	left join
	    food
	on
	    book.fidx = food.fidx
   	where
   		book.cidx = #{cidx}
	</select>
</mapper>