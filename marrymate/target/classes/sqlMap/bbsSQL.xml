<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.marry.bbs">
	<insert id="bbsWrite" parameterType="com.marry.bbs.model.BbsDTO">
		insert into
			bbs
		values(
			bbs_bidx.nextval,
			#{midx},
			#{kind},
			#{horse},
			#{subject},
			#{content},
			sysdate,
			#{img},
			0,
			0,
			0,
			0,
			0,
			0,
			0
		)
	</insert>
	<select id="bbsNotiList" parameterType="Map" resultType="com.marry.bbs.model.BbsDTO">
		select * from
		(select rownum as rnum,a.* from
		(select bbs.*, member.nick from bbs join member on bbs.midx=member.midx where kind='공지사항' order by bidx desc) a) b
		where rnum<![CDATA[>=]]>#{start} and rnum<![CDATA[<=]]>#{end}
	</select>
	<select id="bbsAfterList" parameterType="Map" resultType="com.marry.bbs.model.BbsDTO">
		select * from
		(select rownum as rnum,a.* from
		(select bbs.*, member.nick from bbs join member on bbs.midx=member.midx where kind='웨딩후기' order by bidx desc) a) b
		where rnum<![CDATA[>=]]>#{start} and rnum<![CDATA[<=]]>#{end}
	</select>
	<select id="bbsTalkList" parameterType="Map" resultType="com.marry.bbs.model.BbsDTO">
		select * from
		(select rownum as rnum,a.* from
		(select bbs.*, member.nick from bbs join member on bbs.midx=member.midx where kind='웨딩톡톡' order by bidx desc) a) b
		where rnum<![CDATA[>=]]>#{start} and rnum<![CDATA[<=]]>#{end}
	</select>
	<select id="bbsNotiMini" resultType="com.marry.bbs.model.BbsDTO">
		select bbs.*, member.nick from bbs join member on bbs.midx=member.midx where kind='공지사항' order by bidx desc
	</select>
	<select id="bbsAfterMini" resultType="com.marry.bbs.model.BbsDTO">
		select bbs.*, member.nick from bbs join member on bbs.midx=member.midx where kind='웨딩후기' order by bidx desc
	</select>
	<select id="bbsTalkMini" resultType="com.marry.bbs.model.BbsDTO">
		select bbs.*, member.nick from bbs join member on bbs.midx=member.midx where kind='웨딩톡톡' order by bidx desc
	</select>
	<select id="bbsContent" parameterType="int" resultType="com.marry.bbs.model.BbsDTO">
		select
			bbs.*, member.nick
		from
			bbs
		join
			member
		on
			bbs.midx=member.midx
		where
			bidx=#{bidx}
	</select>
	<insert id="replyWrite" parameterType="com.marry.bbs.model.ReplyDTO">
		insert into
			reply
		values(
			reply_ridx.nextval,
			#{bidx},
			#{midx},
			#{nick},
			#{id},
			#{content},
			sysdate
		)
	</insert>
	<select id="replyList" parameterType="int" resultType="com.marry.bbs.model.ReplyDTO">
		select
			*
		from
			reply
		where
			bidx=#{bidx}
	</select>
	<select id="bbsTotalCount" resultType="int">
		select count(*) from bbs
	</select>
	<update id="watchUp" parameterType="int">
		update
			bbs
		set
			watch=watch+1
		where
			bidx=#{bidx}
	</update>
	<insert id="bestCount" parameterType="Map">
		insert into
			recommand
		values(
			recommand_re_idx.nextval,
			#{bidx},
			#{midx},
			1
		)
	</insert>
	<insert id="worstCount" parameterType="Map">
		insert into
			recommand
		values(
			recommand_re_idx.nextval,
			#{bidx},
			#{midx},
			-1
		)
	</insert>
	<delete id="contentDelete" parameterType="int">
		delete from bbs where bidx=#{bidx}
	</delete>
</mapper>